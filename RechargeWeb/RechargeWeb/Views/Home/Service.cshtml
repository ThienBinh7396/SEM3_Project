@using RechargeWeb.Models;
@using RechargeWeb.Controllers;
@model Tuple<RechargeWeb.Models.ContainerData>
@{
    ViewBag.Title = "Recharge Pro";
    Layout = "~/Views/_ViewHomeStart.cshtml";
    var container = Model.Item1;
}
@section Main{
    <link href="~/Content/service.css" rel="stylesheet" />
    <style>
        .shop_sidebar_area {
            position: relative;
            z-index: 1;
            -webkit-box-flex: 0;
            -ms-flex: 0 0 230px;
            flex: 0 0 230px;
            width: 100%;
            border: 2px solid rgba(56, 128, 244, 0.3);
            background-color: #fff;
            padding: 100px 40px;
        }

        .widget-title {
            font-size: 16px;
            text-transform: capitalize;
            color: #242424;
            margin-bottom: 30px;
        }

        .catagories-menu ul {
            margin: 0;
            padding: 0;
        }

            .catagories-menu ul li:hover a,
            .catagories-menu ul li.active a {
                color: #fbb710;
            }

            .catagories-menu ul a {
                padding: 15px 0 15px 20px;
                text-transform: capitalize;
                font-size: 16px;
                padding: 15px 0 15px 20px;
                display: block;
                font-weight: 400;
                color: #959595;
            }

        .widget.price .range-price {
            font-size: 16px;
            font-weight: 400;
            margin-top: 20px;
            text-transform: uppercase;
            color: #959595;
        }

        .product-topbar .nice-select .list .option.selected {
            color: #fbb710;
        }

        .single-product-wrapper {
            position: relative;
            z-index: 1;
            margin-bottom: 50px;
            overflow: hidden;
            background-color: #ffffff;
        }
    </style>

    <section class="choose-plan choose-plan-bg" id="plan" style="padding-bottom: 56px;" value="@HomeController.ToJson(container.services)">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3">
                    <div class="section-title">
                        <h2>
                            Choose
                            Your Service <span> From @container.mobile_Networks[0].name</span>
                        </h2>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-md-3 col-sm-6">
                    <div class="shop_sidebar_area">

                        <!-- ##### Single Widget ##### -->
                        <div class="widget catagory mb-50">
                            <!-- Widget Title -->
                            <h6 class="widget-title mb-30">Catagories</h6>

                            <!--  Catagories  -->
                            <div class="catagories-menu">
                                <ul>
                                    <li class="active" value="-1"><a href="#">All</a></li>
                                    @foreach (var el in container.type_Services)
                                    {
                                        <li value="@el.id"><a href="#">@el.title</a></li>
                                    }
                                </ul>
                            </div>
                        </div>


                        <!-- ##### Single Widget ##### -->
                        <div class="widget price mb-50">
                            <!-- Widget Title -->
                            <h6 class="widget-title mb-30">Price</h6>

                            <div class="slider-range">
                                <div data-min="0" data-max="@((int)container.number + 1)" data-unit="$" class="slider-range-price ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" data-value-min="0" data-value-max="@((int)container.number + 1)" data-label-result="">
                                    <div class="ui-slider-range ui-widget-header ui-corner-all"></div>
                                    <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                                    <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex="0"></span>
                                </div>
                                <div class="range-price">$0 - $@((int)container.number + 1)</div>
                            </div>

                        </div>
                    </div>
                </div>
                <style>
                    .amado_product_area {
                        border: 2px solid rgba(56, 128, 244, 0.3);
                        background-color: #fff;
                        padding: 100px 40px;
                    }

                    .product-topbar {
                        position: relative;
                        z-index: 100;
                        margin-bottom: 40px;
                    }

                    .align-items-end {
                        -ms-flex-align: end !important;
                        align-items: flex-end !important;
                    }

                    .justify-content-between {
                        -ms-flex-pack: justify !important;
                        justify-content: space-between !important;
                    }

                    .product-topbar .total-products p {
                        margin-bottom: 15px;
                        font-size: 14px;
                        color: #242424;
                        text-transform: uppercase;
                        line-height: 1.9;
                        font-weight: bold;
                    }

                    .d-flex {
                        display: flex;
                    }

                    .product-topbar .total-products .view a:first-child {
                        background-color: #fbb710;
                    }

                    .product-topbar .total-products .view a {
                        -webkit-box-flex: 0;
                        -ms-flex: 0 0 40px;
                        flex: 0 0 40px;
                        width: 40px;
                        height: 40px;
                        background-color: #131212;
                        color: #fff;
                        font-size: 16px;
                        text-align: center;
                        line-height: 44px;
                    }

                    .product-topbar .product-sorting p {
                        margin-bottom: 0;
                        font-size: 14px;
                        height: 40px;
                        background-color: #f5f7fa;
                        line-height: 40px;
                        color: #959595;
                        padding-left: 15px;
                    }

                    .product-topbar .product-sorting form select {
                        background-color: #f5f7fa;
                        border: none;
                        height: 40px;
                        min-width: 80px;
                    }

                    .product-topbar .nice-select {
                        border: none;
                        font-size: 14px;
                        font-weight: 400;
                        height: 40px;
                        padding-left: 0;
                        line-height: 40px;
                        margin: 0;
                        background-color: #f5f7fa;
                        border-radius: 0;
                        text-align: center !important;
                        min-width: 100px;
                    }

                    .card {
                        margin-bottom: 1.875em;
                        border-radius: 5px;
                        padding: 0;
                        -webkit-box-shadow: 0 0 20px rgba(0, 0, 0, 0.08);
                        box-shadow: 0 0 20px rgba(0, 0, 0, 0.08);
                    }

                    .card {
                        position: relative;
                        display: -ms-flexbox;
                        display: flex;
                        -ms-flex-direction: column;
                        flex-direction: column;
                        min-width: 0;
                        word-wrap: break-word;
                        background-color: #fff;
                        background-clip: border-box;
                        border: 1px solid rgba(0,0,0,.085) !important;
                        border-radius: .25rem;
                    }

                        .card .card-body {
                            float: left;
                            padding: 1.25em;
                            padding-top: 0;
                            position: relative;
                            width: 100%;
                        }

                            .card .card-body .header {
                                padding: 16px;
                                margin-bottom: 23px;
                            }

                            .card .card-body .pname {
                                color: #2141ba !important;
                                font-size: 17px !important;
                            }

                            .card .card-body .body {
                                padding: 0 24px 0px;
                                height: 160px;
                                overflow-y: auto;
                            }

                            .card .card-body h4 {
                                padding: 0;
                                color: #cc0c0c;
                                margin-top: 24px;
                            }

                    .tb-buy-service {
                        margin: 0 auto 16px;
                        cursor: pointer;
                    }

                    .tb-fast {
                        animation-duration: 0.45s;
                    }

                        .tb-fast:nth-child(4n + 1) {
                            animation-delay: 0.2s;
                        }

                        .tb-fast:nth-child(4n + 2) {
                            animation-delay: 0.4s;
                        }

                        .tb-fast:nth-child(4n + 3) {
                            animation-delay: 0.6s;
                        }

                        .tb-fast:nth-child(4n + 4) {
                            animation-delay: 0.8s;
                        }
                </style>
                <div class="col-md-9 col-sm-6">
                    <div class="amado_product_area section-padding-100">
                        <div class="container-fluid">

                            <div class="row">
                                <div class="col-12">
                                    <div class="product-topbar d-xl-flex align-items-end justify-content-between" style="position: relative">
                                        <!-- Total Products -->
                                        <div class="total-products" style="margin: 0; padding: 0; width: 260px;">
                                            <p>Showing <span class="status">1-8</span> 0f <span class="max-status">@container.services.Count()</span> entries</p>
                                            <div class="view d-flex">
                                                <a href="#"><i class="fa fa-th-large" aria-hidden="true"></i></a>
                                                <a href="#" style="display: none"><i class="fa fa-bars" aria-hidden="true"></i></a>
                                            </div>
                                        </div>
                                        <!-- Sorting -->
                                        <div class="product-sorting d-flex" style="float: right; position: absolute; top: 0; right: 0">
                                            <div class="sort-by-date d-flex align-items-center mr-15">
                                                <p>Sort by</p>
                                                <form action="#" method="get">
                                                    <select name="select" id="sortBydate">
                                                        <option value="0">None</option>
                                                        <option value="name">Name</option>
                                                        <option value="price">Price</option>
                                                    </select>
                                                </form>
                                            </div>
                                            <div class="view-product d-flex align-items-center">
                                                <p>View</p>
                                                <form action="#" method="get">
                                                    <select name="select" id="viewProduct">
                                                        <option value="8">8</option>
                                                        <option value="16">16</option>
                                                        <option value="24">24</option>
                                                        <option value="32">32</option>
                                                    </select>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row" id="cover_service">

                            </div>

                            <div class="row">
                                <div class="col-12">
                                    <!-- Pagination -->
                                    <nav aria-label="navigation">
                                        <ul class="pagination justify-content-end mt-50" style="float: right">
                                            <li class="page-item active"><a class="page-link" href="#">01.</a></li>
                                            <li class="page-item"><a class="page-link" href="#">02.</a></li>
                                            <li class="page-item"><a class="page-link" href="#">03.</a></li>
                                            <li class="page-item"><a class="page-link" href="#">04.</a></li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>
}
@section Script{
    <script>
        $(document).ready(function (e) {
            var amount = 8;
            var page = 1;

            function buyService(that) {
                var sid = that.parent().find(".header").attr("s-id");
                var price = that.prev().find(".service_price").text();
            $.ajax({
                url: "@Url.Action("AddToCart", "Home")",
                type: "GET",
                data: {
                    qty: 1,
                    price: price,
                    id_service: sid
                },
                success: function (data) {
                    if (data == 1) {
                        Swal.fire({
                            type: 'info',
                            title: 'Successful...',
                            text: 'Add to cart successful!',
                        })
                        showCart();
                    }
                    if (data == 0) {
                        Swal.fire({
                            type: 'info',
                            title: 'Oops...',
                            text: 'Something went wrong!',
                        })
                    }
                    if (data == -1) {
                        Swal.fire({
                            type: 'error',
                            title: 'Oops...',
                            text: 'Please login before buy something!',
                            showCancelButton: false,
                            confirmButtonColor: '#3085d6',
                            confirmButtonText: 'Login!'
                        }).then((result) => {
                            $("html, body").animate({
                                scrollTop: $("#sign_in").position().top
                            }, 200);
                        });
                    }
                }
            })
            }



            var service = JSON.parse($("#plan").attr("value"))["$values"];

            var currentService = service;

            function format(num) {
                return num > 9 ? num : "0" + num;
            }
            function showService() {
                $("#cover_service").empty();
                var amount_page = parseInt(currentService.length / amount) + 1;

                $(".pagination").empty();

                console.log(amount_page);
                for (var i = 0; i < amount_page; i++) {
                    if (page == (i + 1)) {
                        $(".pagination").append(
                            `<li class="page-item active" value="${i + 1}"><a class="page-link" href="#" id="page_${i}"> ${format(i + 1)}.</a></li>`
                        )
                    } else {
                        $(".pagination").append(
                            `<li class="page-item " value="${i + 1}"><a class="page-link" href="#" id="page_${i}"> ${format(i + 1)}.</a></li>`
                        )
                    }

                    $("#page_" + i).parent().click(function (e) {
                        e.preventDefault();
                        var x = Number($(this).attr("value"));
                        if (page != x) {
                            page = x;
                            showService();
                        }
                    })
                }

                var start = (page - 1) * amount;
                var end = page * amount > currentService.length ? currentService.length : page * amount

                $(".total-products .status").text(`${(page - 1) * amount + 1}-${end}`);
                $(".total-products .max-status").text(`${currentService.length}`);

                for (var i = start; i < end; i++) {

                    $("#cover_service").append(
                        ` <div class="col-md-6 animated slideInUp tb-fast">`
                        + `<div class="single-price-plan card">`
                        + `<div class="card-body">`
                        + `<div class="header" id="${currentService[i].id}" s-id="${currentService[i].id}">`
                        + `<span class="pname">${currentService[i].name}</span>`
                        + `</div>`
                        + `<div class="body">${currentService[i].description}</div>`
                        + `<h4>$<span class="service_price">${currentService[i].price.toFixed(2)}</span> </h4>`
                        + `<p class= "boxed-btn tb-buy-service js_clear_default" id="btn_buy_${i}" > Buy service</p ></div ></div ></div >`
                    )

                    $(`#btn_buy_${i}`).click(function (e) {
                        e.preventDefault();
                        buyService($(this));
                    })
                }

            }
            showService();
            $("#viewProduct").change(function (e) {
                if ($(this).val() != amount) {
                    amount = $(this).val();

                    showService();
                }
            })
            $("#sortBydate").change(function (e) {
                console.log($(this).val());

                var temp;
                if ($(this).val() == "name") {
                    for (var h = 0; h < currentService.length - 1; h++) {
                        for (var k = h + 1; k < currentService.length; k++) {
                            if (currentService[h].name.charAt(0) > currentService[k].name.charAt(0)) {
                                temp = currentService[h];
                                currentService[h] = currentService[k];
                                currentService[k] = temp;
                            }
                        }
                    }
                    showService();
                }
                if ($(this).val() == "price") {
                    for (var h = 0; h < currentService.length - 1; h++) {
                        for (var k = h + 1; k < currentService.length; k++) {
                            if (currentService[h].price > currentService[k].price) {
                                temp = currentService[h];
                                currentService[h] = currentService[k];
                                currentService[k] = temp;
                            }
                        }
                    }
                    showService();
                }

            })

            $(".catagories-menu li").click(function (e) {
                e.preventDefault();
                if (!$(this).hasClass("active")) {
                    page = 1;

                    $(".catagories-menu li").removeClass("active");
                    $(this).addClass("active");

                    var category = Number($(this).attr("value"));
                    if (category == -1) {
                        currentService = service;
                        showService();
                        return;
                    }
                    currentService = [];
                    service.forEach(it => {
                        if (category == it.type_id) {
                            currentService.push(it);
                        }
                    })

                    showService();

                }
            })


            $("#main-menu li").removeClass("active");
            $("#main-menu li#li-service").addClass("active");

            if ($.fn.niceSelect) {
                $('select').niceSelect();
            }

            $('.slider-range-price').each(function () {
                var min = jQuery(this).data('min');
                var max = jQuery(this).data('max');
                var unit = jQuery(this).data('unit');
                var value_min = jQuery(this).data('value-min');
                var value_max = jQuery(this).data('value-max');
                var label_result = jQuery(this).data('label-result');
                var t = $(this);
                $(this).slider({
                    range: true,
                    min: min,
                    max: max,
                    values: [value_min, value_max],
                    slide: function (event, ui) {
                        var result = label_result + " " + unit + ui.values[0] + ' - ' + unit + ui.values[1];
                        t.closest('.slider-range').find('.range-price').html(result);

                        console.log(ui.values[0], ui.values[1]);

                        currentService = [];

                        service.forEach(it => {
                            if (it.price < ui.values[1] && it.price > ui.values[0]) {
                                currentService.push(it);
                            }
                        });
                        showService();
                    }
                });
            });
        })
    </script>
}

